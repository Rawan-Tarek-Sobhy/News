<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News App</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
    <div class="main-nav container flex">
        <a href="#" onclick="reload()" class="company-logo">
            <img src="https://imgs.search.brave.com/-c3mRpPiPL-IkCZVSnI6w25ibXCSN5wF9z8tcNx4qzQ/rs:fit:860:0:0/g:ce/aHR0cHM6Ly90My5m/dGNkbi5uZXQvanBn/LzA1LzA4LzA2LzE4/LzM2MF9GXzUwODA2/MTg0MF9xM3pIMVo0/TWJnR2xXTTVvYUpt/VkpUdUR4b09teE4z/bi5qcGc"
                alt="company logo">
        </a>
        <div class="nav-links">
            <ul class="flex">
                <li><a class="hover-link nav-item" id="home" onclick="onNavItemClick('India')">Home</a></li>
                <li><a class="hover-link nav-item" id="about" href="about.html">About</a></li>
                <li><a class="hover-link nav-item" id="contact" href="contact.html">Contact</a></li>
                <li><a class="hover-link nav-item" id="search" href="index.html">News</a></li>
            </ul>
        </div>
    </div>
</nav>

<main>
    <section id="carouselSection" class="mb-5">
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel" data-interval="3000">
            <div class="carousel-inner" style="max-height: 400px;">
                <!-- News images will be added dynamically here -->
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </section>

    <section id="latestNewsSection" class="container mb-5">
        <h2>Latest News</h2>
        <div id="latest-news" class="row">
            <!-- Latest news articles will be added dynamically here -->
        </div>
    </section>

    <div class="cards-container container flex" id="cards-container"></div>

    <template id="template-news-card">
        <div class="card">
            <div class="card-header">
                <img src="https://via.placeholder.com/400x200" alt="news-image" id="news-img">
            </div>
            <div class="card-content">
                <h3 id="news-title">This is the Title</h3>
                <h6 class="news-source" id="news-source">End Gadget 26/08/2023</h6>
                <p class="news-desc" id="news-desc">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Recusandae saepe quis voluptatum quisquam vitae doloremque facilis molestias quae ratione cumque!</p>
            </div>
        </div>
    </template>

    <template id="template-latest-news">
        <div class="col-md-4">
            <div class="card mb-4">
                <img class="card-img-top" src="" alt="news-image">
                <div class="card-body">
                    <h5 class="card-title">News Title</h5>
                    <p class="card-text">News Description</p>
                    <a href="#" class="btn btn-primary" target="_blank">Read more</a>
                </div>
            </div>
        </div>
    </template>

    <script>
        const API_KEY = "4b77a73386bb4be29d1cfe4c95999f7d";
        const url = "https://newsapi.org/v2/everything?q=";

        window.addEventListener("load", () => {
            fetchNews("India");
            fetchLatestNews();
            startSlider();
        });

        function reload() {
            window.location.reload();
        }

        async function fetchNews(query) {
            const res = await fetch(`${url}${query}&apiKey=${API_KEY}`);
            const data = await res.json();
            bindData(data.articles);
        }

        function bindData(articles) {
            const cardsContainer = document.getElementById("cards-container");
            const newsCardTemplate = document.getElementById("template-news-card");

            cardsContainer.innerHTML = "";

            articles.forEach((article) => {
                if (!article.urlToImage) return;
                const cardClone = newsCardTemplate.content.cloneNode(true);
                fillDataInCard(cardClone, article);
                cardsContainer.appendChild(cardClone);
            });

            // Set active class for the first navigation item
            document.getElementById('home').classList.add('active');
        }

        function fillDataInCard(cardClone, article) {
            const newsImg = cardClone.querySelector("#news-img");
            const newsTitle = cardClone.querySelector("#news-title");
            const newsSource = cardClone.querySelector("#news-source");
            const newsDesc = cardClone.querySelector("#news-desc");

            newsImg.src = article.urlToImage;
            newsTitle.innerHTML = article.title;
            newsDesc.innerHTML = article.description;

            const date = new Date(article.publishedAt).toLocaleString("en-US", {
                timeZone: "Asia/Jakarta",
            });

            newsSource.innerHTML = `${article.source.name} Â· ${date}`;

            cardClone.first
        }

cardClone.firstElementChild.addEventListener("click", () => {
    window.open(article.url, "_blank");
});

async function fetchLatestNews() {
const res = await fetch(`${url}latest&apiKey=${API_KEY}`);
const data = await res.json();
bindLatestNews(data.articles);
}

function bindLatestNews(articles) {
const latestNewsContainer = document.getElementById("latest-news");
const latestNewsTemplate = document.getElementById("template-latest-news");

latestNewsContainer.innerHTML = "";

articles.forEach((article) => {
    if (!article.urlToImage) return;
    const newsClone = latestNewsTemplate.content.cloneNode(true);

    newsClone.querySelector(".card-img-top").src = article.urlToImage;
    newsClone.querySelector(".card-title").innerText = article.title;
    newsClone.querySelector(".card-text").innerText = article.description;
    newsClone.querySelector(".btn").href = article.url;

    latestNewsContainer.appendChild(newsClone);
});
}

let curSelectedNav = null;
function onNavItemClick(category) {
fetchNews(category);
const navItem = document.getElementById(category);
curSelectedNav?.classList.remove("active");
curSelectedNav = navItem;
curSelectedNav.classList.add("active");
}

function startSlider() {
const carouselInner = document.querySelector(".carousel-inner");

// Fetch news and add images to the carousel
fetch(url + 'India&apiKey=' + API_KEY)
    .then(response => response.json())
    .then(data => {
        const articles = data.articles;
        articles.forEach((article, index) => {
            if (!article.urlToImage) return;
            const carouselItem = document.createElement("div");
            carouselItem.classList.add("carousel-item");

            if (index === 0) {
                carouselItem.classList.add("active");
            }

            const img = document.createElement("img");
            img.classList.add("d-block", "w-100");
            img.src = article.urlToImage;
            img.alt = article.title;
            img.style.height = "400px"; // Set the height of the carousel images

            carouselItem.appendChild(img);
            carouselInner.appendChild(carouselItem);
        });

        // Start the carousel
        $('#carouselExampleIndicators').carousel({
            interval: 3000
        });
    })
    .catch(error => console.log(error));
}
</script>
</main>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>
